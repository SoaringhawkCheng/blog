---
title: 「高性能MYSQL」读书笔记
catalog: true
date: 2019-04-05 14:38:09
subtitle: 
tags: 
- sql
categories:
- 编程
---
# 隔离性

针对隔离性遇到的问题如下：

1. 脏读：读到了别的事务回滚前的脏数据

2. 不可重复读：事务A前后两次读取数据不一致(事务B改变了数据，update和delete)

3. 幻读：事务A首先根据索引得到N条数据，再次搜索发现有N+M条数据了(事务B进行了insert

4. 丢失更新：同时更新数据，一方数据被覆盖

# 隔离级别

1. read uncommitted(未提交读)

解决了丢失更新问题

读取时是**不加锁**的；但在更新数据时加**行共享锁**

2. read committed(提交读)

解决了脏读的问题

给读的数据加**行级共享锁**，**读完就释放**；写数据加**行级排他锁**，**事务结束释放**

3. repeatable read(可重复读)

解决了不可重复读问题

给读的数据加行级共享锁，**事务结束释放**；写数据加**行级排他锁**，**事务结束释放**

4. serializable(序列化)

解决了幻读问题

读数据加**表级共享锁**;写数据加**表级排他锁**

# 乐观锁和悲观锁

## 乐观锁

获取数据不加锁

更新数据判断数据是否被修改，如果修改不更新

适合于多读的机制，可以提高吞吐量

一般使用version方式和CAS方式

1. version方式



2. CAS方式

compare and swap或者compare and set，涉及到三个操作数：内存值、预期值和新值

## 悲观锁

每次获取数据都加锁

依赖数据库的锁机制，无法保证外部系统不会修改数据

