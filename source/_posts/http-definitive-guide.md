---
title: 「HTTP权威指南」学习笔记[DOING]
catalog: true
date: 2020-05-31 19:22:48
subtitle:
header-img:
tags:
- net
categories:
- 工程
---
> 书籍豆瓣链接：[《HTTP权威指南》](https://book.douban.com/subject/10746113/)
> 
> 相关资料笔记：[《HTTP权威指南》概念手册](https://github.com/SoaringhawkCheng/http)
> 
> 开始学习时间：
> 
> 预计完成时间：
> 
> 实际完成时间：

# 前言

《HTTP权威指南》中的主要概念和内容都在[《HTTP权威指南》概念手册](https://github.com/SoaringhawkCheng/http)中，本笔记对部分知识点进行了提炼和补充

# 第一部分 HTTP基础

## 第1章 HTTP概述

### URI

有两个子集URL和URN，URL受路径变化影响，URN不会

### web结构组件

隧道 连接通道，http信道上发送非http协议资源

## 第2章 URL与资源

### url编码

为了避开安全字符集表示法带来的限制，使用编码机制，对不安全字符进行转义

## 第3章 HTTP报文

### 方法

HEAD 获取文档首部

TRACE 对可能经过代理服务器传送到服务器上的报文进行追踪

OPTIONS 请求服务器告知其支持什么功能

### 状态码

#### 2xx 成功状态码

#### 3xx 重定向状态码

301 永久重定向

302 临时重定向(HTTP1.0)

303 临时重定向(HTTP1.1)

304 未改变

307 临时重定向(HTTP1.1)

#### 4xx 客户端错误

#### 5xx服务端错误
![](https://github.com/SoaringhawkCheng/blog/blob/master/source/_posts/http-definitive-guide/5xx.png?raw=true)

500 服务器内部错误 所请求的服务器遇到意外的情况并阻止其执行请求

501 请求未实现 只有GET和HEAD是要求服务器支持的，它们必定不会返回此错误代码

502 网关错误 表示作为网关或代理角色的服务器，从上游服务器中接收到的响应是无效的

503 服务器不可用 通常造成这种情况的原因是由于服务器停机维护或者已超载

504 网关超时 当服务器作为网关，不能及时得到响应时返回此错误代码

505 HTTP版本不支持 服务器不支持请求中所使用的HTTP协议版本

### 首部

Cookie 客户端向服务器传送的cookie

Set-Cookie 服务器传送cookie给客户端

## 第4章 连接管理

### Connection首部

两个相邻的HTTP应用程序会为他们共享的连接应用一组选项，Connection首部字段中有一个逗号分隔的连接标签列表，为此连接指定了一些不会传播到其他连接的选项

### 串行连接

HTTP1.0的基本特点是：

1. 每来一个请求就开一个TCP连接，请求完了关闭连接
2. 服务器无法在客户端没有请求的情况下，向客户端推送消息

### 并行连接

同时开多个tcp连接，并行处理多个http事务。tcp连接会竞争带宽，大量连接会消耗很多内存资源

浏览器确实会使用并行连接，但是会将并行连接数限制为一个较小的值(通常是4个)

### 持久连接

* HTTP1.0

HTTP1.0设置了keepalive机制，来实现tcp连接的复用

Connection首部添加Keep-Alive，同一个四元组的tcp连接可以串行处理多个http事务

在HTTP响应报文中，返回一个Content-Length首部，告诉客户端单次请求的响应长度，与其他响应区分

使用Connection:Close在处理完请求后关闭持久连接

* HTTP1.1

HTTP1.1默认连接复用，除非显示加上Connection:Close属性

Content-Length首部的问题是，服务端需要计算响应包长度

HTTP1.1引入了chunk机制，将相应的body分块，块之间有分隔标记，使用Transfer-Encoding:chunked首部告诉客户端相应包含几个块

### 管道化连接

HTTP1.1在持久连接上引入了pipeline机制，发送完第一个请求，不必等响应到达就可以发送下一个

服务端必须按请求报文的顺序返回响应报文，即**队头阻塞**问题

* 二进制分帧

HTTP2为了解决**队头阻塞**，将TCP报文转换成二进制，并分成多个帧

每对请求和响应组成一个逻辑流，每个流的不同帧都带有流ID和帧ID

# 第二部分 HTTP结构

## 第5章 Web服务器

### 重定向

永久搬离的资源 301

临时搬离的资源 303 307

URL增强 重写URL，嵌入上下文，是事物间维持状态的方式 303 307

负载均衡 303 307

服务器关联 服务器可能会有用户的本地信息，重定向到包含客户端信息的服务器上去 303 307

## 第6章 代理

### web的中间实体

代理和网关的对比：代理的两端使用相同的协议，网关的两端使用不同的应用层协议，网关负责转换

### 为什么使用代理

主要使用代理作以下功能使用：

1. 儿童过滤器：如服务器响应的成人内容进行过滤
2. 文档访问控制：验证客户端访问某个的文件需要的证书
3. 安全防火墙：提供一个防火墙保护客户端或服务器
4. web缓存（缓存资源的副本）：对客户端响应资源的副本，节省带宽、减少网络拥堵
5. 反向代理（原始服务的替代物，能访问其他服务器，作服务器加速器使用）：反向代理伪装成原始服务器，不过与服务器不同的是反向代理还可以向其他服务器发送请求，以便实现按需定位所请求的内容！
6. 内容路由器：比如网络中实现为了一些付费用户提供更好、更快的网络速度，让请求发往缓存服务器，而没有付费的用户请求则发往更远或原始服务器！
7. 转码器（比如改变图片格式，以便更轻巧利于传输）
8. 匿名者：保护客户端隐私

## 第7章 缓存

### 缓存的优点

减少了冗余的数据传输

缓解了网络的带宽瓶颈

降低了原服务器的压力

降低了距离时延

### 缓存分类

私有缓存 web浏览器中有内建的私有缓存

公有缓存 公有缓存是特殊的共享代理服务器，被称为缓存代理服务器

### 副本新鲜度

HTTP使用文档过期和服务器再验证机制，保持已缓存数据与原服务器数据之间充分一致

已缓存对象包含服务器响应主体和原始服务器响应首部，以及其他元数据，用来记录对象停留时长，访问次数

#### 文档过期

通过特殊的HTTP Cache-Control首部和Expires首部，HTTP让原始服务器附加一个“过期日期”

#### 服务器再验证

已缓存对象过期，需要进行再验证

* 验证方法

	If-Modified-Since首部和Last-Modified响应首部，判断原始服务器文档截止期之后是否改动

	If-None-Match，根绝实体标签Etag进行版本比较
	
* 更新规则

	如果验证显示内容变化，缓存会获取一份新的文档副本
	
	如果没有，缓存只需要获取新的首部，包括新的过期时间

### 缓存和广告

因为缓存的存在，导致某些靠用户点击次数收费的广告的请求未达到原始服务，从而服务器很难对用户进行了多少次点击进行计数！一种解决方案就是配置缓存，每次访问时都与原始服务器进行再验证。这样，每次访问时都会将命中推向原始服务器，但通常不会传送任何主体数据。当然，这样会降低事务处理的速度。

## 第8章 集成电路：网关、隧道及中继

### 网关

web网关在一侧使用HTTP协议，另一侧使用另一种协议

使用<客户端协议>/<服务端协议>格式对网关进行描述

服务器端网关 使用其他协议和服务端通信，使用HTTP协议和客户端通信

客户端网关 使用其他协议和客户端通信，使用HTTP协议和服务端通信

### 协议网关

HTTP/* 服务端Web网关 将客户端HTTP请求转换为其他协议

HTTP/HTTPS 服务端安全网关

HTTPS/HTTP 客户端安全网关 谨慎使用，确保网关和原始服务器之间的网络是安全的

### 资源网关

应用程序服务器，将目标服务器和网关结合在一个服务器实现

客户端通过HTTP与应用程序服务器通信，服务器将请求通过网关应用编程接口(Application Programming, API)发送给运行在服务器上的应用程序

#### CGI

第一个流行的应用程序网关API是通用网关接口(Common Gateway Interface, CGI)。CGI是一个标准接口集，Web服务器可以用它来装载程序，响应HTTP请求，并收集输出数据，构造HTTP响应会送。

CGI工作原理：每当客户请求CGI的时候，WEB服务器就请求操作系统生成一个新的CGI解释器进程(如php-cgi.exe)，CGI 的一个进程则处理完一个请求后退出，下一个请求来时再创建新进程。当然，这样在访问量很少没有并发的情况也行。可是当访问量增大，并发存在，这种方式就不 适合了。于是就有了fastcgi。

## 第9章 Web机器人

## 第10章 HTTP-NG

# 第三部分 识别、认证与安全

## 第11章 客户端识别与cookie机制

### 胖URL

把用户信息添加到url

### Cookie分类

cookie两类会话：会话cookie和持久cookie

会话cookie退出浏览器就被删除了

### Cookie属性

domain: cookie的域

allh: 那些主机可以使用此cookie

path: 那些路径能使用cookie

secure: 是否在发送https报文的时候使用cookie

expires: 过期时间

name: cookie的名字

value: cookie的值

### Cookie设置[break point]

cookie在性质上是绑定在特定的域名下的。给设定的域名发送请求时，都会包含这个cookie

当前域名只能设置当前域名以及他的父域名，不能设置子域名

cookie的作用域是domain本身以及domain下的所有子域名。

## 第12章 基本认证机制



## 第13章 摘要认证



## 第14章 安全HTTP



# 第四部分 实体、编码和国际化

## 第15章 实体和编码



## 第16章 国际化



## 第17章 内容协商与转码



# 第五部分 内容发布与分发

## 第18章 Web主机托管



## 第19章 发布系统



## 第20章 重定向与负载均衡



## 第21章 日志记录与使用情况跟踪



# 第六部分 附录